# Session Log

## Current State
- Forge is a SwiftPM CLI with challenges defined in `Sources/forge/Challenges.swift` (now 1–241, including bridge challenges).
- Challenge headers live inside each `starterCode`; the CLI no longer prepends headers when writing files.
- Output validation trims whitespace/newlines before comparison.
- Challenge and project checks are triggered manually by pressing Enter.
- SwiftPM tests exist in `Tests/forgeTests/forgeTests.swift`, plus a check script at `scripts/check.sh`.
- Docs updated: `README.md` includes run/reset + learning overview; `AGENTS.md` includes structure + commands; `ROADMAP.md` added.
- Challenges and projects now support stored hints and solutions.
- Cheatsheets are available via `c`, with shared topic blocks and project-specific blocks.
- Core + Mantle content are implemented; Crust 1–3 challenges and projects are implemented.
- FTS standards have not yet been applied across the curriculum or engine.

## Recent Changes
- Updated FTS gap analysis and roadmap to reflect default constraint enforcement with `--allow-early-concepts` as the opt-out.
- Added a startup note when `--allow-early-concepts` is active to indicate warn-only mode.
- Added per-unit constraint metadata via concept introductions and switched constraint checks to use that metadata (still regex-based).
- Added explicit integration prerequisites with runtime checks that block if required concepts are introduced later in the sequence.
- Added a fixture-backed input file and updated the readLine manual-check instructions to use scripted input.
- Added a fixture-backed args file and updated the command-line arguments manual-check instructions.
- Improved challenge feedback details with numbered expected/actual lines and consistent line-by-line validation in random mode.
- Reduced constraint false positives by stripping comments and string literals (including multiline/raw strings) before regex checks.
- Switched constraint detection to token-based heuristics (with tuple regex fallback) for fewer false positives.
- Added per-topic adaptive attempt tracking to `workspace/.adaptive_stats` as an adaptive progression stub.
- Documented the adaptive stats data model and proposed Phase 2+ gating logic in the FTS spec and README.
- Random mode now weights selection using adaptive stats (more fails → higher weight).
- Stage review selection now weights topics using adaptive stats when available.
- Expanded constraint coverage to include struct/class basics, properties, initializers, mutating methods, and self.
- Expanded constraint coverage to include extensions, generics, associated types, and where clauses.
- Expanded constraint coverage to include Task, MainActor, and Sendable.
- Expanded constraint coverage for protocol conformance, protocol extensions, and default implementations.
- Expanded constraint coverage for Task.sleep and withTaskGroup (concurrency advanced).
- Expanded constraint coverage for access control and error-handling patterns.
- Added access-control refinement for public/open usage.
- Added constraint coverage for try! (forced try).
- Added access-control nuance detectors for fileprivate and internal.
- Added access-control setter constraint for private(set).
- Added SwiftPM constraint concepts (basics, dependencies, build configs) and tagged SwiftPM integration prereqs.
- Added dependency injection + protocol mocking constraint concepts and tagged the Crust 3 integration prereqs accordingly.
- Added Core 1 constraint concepts (comparisons, boolean logic, compound assignment, string interpolation) and enforced them for integration challenges.
- Realigned Core 1 function introduction: Challenge 1 no longer uses functions; Challenge 14 now introduces functions.
- Refined constraint detection to ignore for-in loops as closures and $0 shorthand as projected values; added early where-clause intro in Core 3.
- Adjusted Crust concurrency sequencing: Task introduced in Challenge 172; MainActor now only requires Task; property wrapper detection ignores @MainActor.
- FTS spec updated to reflect refined detector and clean sequencing scans across layers.
- Added dependency-injection and protocol-mocking detection heuristics to constraint checks.
- Refined dependency-injection detection to require `any Protocol` properties to avoid type-erasure false positives.
- FTS spec updated to note DI/mock heuristics in constraint enforcement.
- FTS checklist review: no status upgrades; sequencing scans clean but constraints remain heuristic.
- README updated to mention heuristic early-concept checks.
- FTS spec now marks Phase 1 implementation complete with remaining gaps listed.
- FTS spec audit updated: clarified Phase 1 completion wording and documented integration prereq audit.
- FTS spec now includes a post‑curriculum re‑audit checklist.
- Added `--disable-di-mock-heuristics` to make DI/mock constraint detection configurable.
- FTS spec updated to mention the DI/mock heuristic toggle.
- Next curriculum edits should trigger the FTS re-audit checklist (review scan + integration prereq scan).
- Added gap-filling extra challenges in Core/Mantle/Crust (242–250).
- Curriculum doc updated with random-mode coverage notes for extras 242–250.
- Added Core 1 Function Basics before parameters and consolidated parameter practice.
- Added Task as an explicit prereq for the Crust integration challenge that uses Task.
- Added `random adaptive` to focus random sets on weakest topics.
- Added `forge stats` to print adaptive per-topic counts.
- Added `forge stats --reset` to clear adaptive stats and expanded constraint coverage for result builders/macros/projected values.
- Main flow now inserts adaptive practice sets after repeated failures (threshold-based).
- Added CLI flags to tune adaptive gating thresholds and counts.
- Adjusted FTS spec gaps/strengths to reflect adaptive nondeterminism and updated integration coverage note.
- Added `--adaptive-off` to disable adaptive gating in the main flow.
- Changed `reset` to exit by default and added `reset --start` to immediately continue into the flow; documented in CLI usage and README.
- Rebuilt Core 1 to explicitly cover type inference and make arithmetic, compound assignment, comparison, and logical operators exhaustive.
- Reordered Core 2 to introduce ranges without properties, add a collection-properties challenge after arrays/loops, and move tuples closer to collections.
- Added an Array Metrics challenge to prepare learners for Core 2 Project A.
- Expanded Core 3 with a slower closure ramp and added explicit tuple and enum micro-sequences.
- Added void-argument label coverage and more guidance in variadics, inout, nested functions, error handling, and simulated I/O/test challenges.
- Added guidance to Core 2 and Core 3 projects to improve preparation for tuple and parsing work.
- Inserted a basic array-creation challenge before append/count; expanded collection properties coverage.
- Renumbered Core 2 to 19–39 and Core 3 to 40–70, then to 40–71 after adding min/max.
- Added a Core 3 `min()`/`max()` challenge after `reduce`.
- Repaired `makeProjects()` and normalized `expectedOutput` strings after curriculum edits; restored `getCurrentProgress` for tests.
- Added a non-trailing closure call challenge before trailing closures; added block-comment hints for early closures with fully expanded closure literals.
- Expanded the Core 3 closure sequence with compression steps (implicit return, inferred types, inferred trailing closures), added a Shorthand Closure Syntax I/II split, and moved the annotated closure assignment to sit with assigned-closure steps.
- Logged curriculum changes in `CURRICULUM_CHANGES_LOG.md`.
- Ran `scripts/check.sh`; build and tests passed.
- Ran `swift run forge verify-solutions 76`; verification passed.
- Fixed deterministic verification for challenges 197 and crust-extra-xctest-micro (Foundation import + XCTest stub).
- Ran `swift run forge verify-solutions 197-197` and `250-250`; verification passed.
- Ran `swift run forge verify-solutions 1-250`; verification passed.
- Documented the XCTest stub approach in README and FTS spec.
- Replaced file watching with manual Enter-to-check flow; added hint/solution commands in the CLI for challenges and projects.
- Ran `scripts/check.sh` after enabling project hints; build and tests passed.
- Migrated inline starter hints into `hints` and `solution` fields for closure and collection challenges.
- Populated hints and solutions for all challenges and projects.
- Ran `scripts/check.sh`; build and tests passed.
- Moved tuple reinforcement into Core 2 and removed tuple challenges from Core 3.
- Ran `scripts/check.sh`; build and tests passed.
- Removed Structs from Core 3 to align with the roadmap; renumbered subsequent challenges.
- Ran `scripts/check.sh`; build and tests passed.
- Rewrote all challenge and project hints to be more actionable and less redundant.
- Updated hints for challenges 1–30 to per-block guidance and regenerated hints for challenges 31–171 and projects from solution blocks.
- Moved tuple-return coverage into Core 2 (Challenge 40) and renumbered Core 3 to 41–78.
- Added challenge topics/tiers plus a `random` mode for practice sets; extras are tagged for variety.
- Added extra projects per core level (core1b/core1c, core2b/core2c, core3b/core3c) and kept them out of the default flow.
- Rewrote Core 1–3 challenge hints and Core 1–3 project hints to adhere to the hint rules.
- Expanded extra Core practice with 20 new challenges (89–108) across conditionals, loops, collections, functions, and optionals.
- Added 12 extra challenges (109–120) for strings, comparisons, and ranges practice.
- Added Mantle challenge stubs (121–153) with placeholder manual-check prompts; Mantle is not wired into the CLI yet.
- Wired Mantle challenges into the main flow and random mode (manual-check placeholders for now).
- Filled out Mantle 1 challenges (121–134) with expected outputs, hints, and solutions.
- Implemented Mantle 2 challenges (135–144) with expected outputs, hints, and solutions.
- Implemented Mantle 3 challenges (145–153) with expected outputs, hints, and solutions.
- Added Mantle projects (mantle1a/mantle2a/mantle3a) and wired them into the main flow.
- Added extra Mantle projects (mantle1b/mantle1c, mantle2b/mantle2c, mantle3b/mantle3c).
- Interleaved Mantle challenges with their pass-level projects (121–134 → mantle1a, 135–144 → mantle2a, 145–153 → mantle3a).
- Ran `scripts/check.sh`; build and tests passed.
- Updated Mantle challenge 150 to use a constrained extension (to avoid re-introducing protocol extensions).
- Mantle sequencing scan after 150 update: no issues found in 121–153.
- Ran `scripts/check.sh`; build and tests passed.
- Core sequencing scan completed (no changes required beyond prior struct removal).
- Mantle 2 challenge 141 now explicitly introduces protocol extensions; Mantle 3 challenge 150 remains the constrained extension variant.
- Mantle sequencing scan after protocol-extension update: no issues found in 121–153.
- Core deep review: removed structs from Core 3 by replacing Challenge 43 with a string prefix/suffix check; clarified try? output in Challenge 73.
- QC fixes: Mantle 1 lazy property challenge uses var for lazy access; Mantle 3 project text clarifies weak manager reference.
- Mantle 1 challenge 123 now uses a non-mutating method so mutating is introduced later in challenge 125.
- Mantle sequencing pass: removed early mentions of protocol extensions in challenge 141 text.
- Mantle project sequencing pass: removed early constrained-extension wording from mantle2b.
- Extras sequencing pass: no ordering issues found in challenges 79–120.
- Added Mantle extra challenges (154–171) across structs/properties, protocols/extensions/errors, and generics/ARC.
- Ran `scripts/check.sh`; build and tests passed.
- Mantle extra sequencing pass: no ordering issues found in challenges 154–171.
- Documented the current implemented curriculum in `System Design Docs/04. Curriculum (Current).md`.
- Added random-mode topic list to `System Design Docs/04. Curriculum (Current).md`.
- Updated random mode filters to use tier (`mainline`/`extra`) and layer (`core`/`mantle`/`crust`).
- Added `random --help` output with topics/tiers/layers and updated docs.
- Renamed project tier to `mainline`/`extra` and added project layer (`core`/`mantle`/`crust`) for clarity.
- Added `project --list` with tier/layer filters and documented project tiers/layers.
- Added `project --random` support with tier/layer filters and documented usage.
- Documented `project --help` usage in repo docs.
- Added a `project --help` hint when an unknown project id is provided.
- Added Crust 1 challenges (172–189) and wired them into the main flow and random mode.
- Added Crust 2 challenges (190–207) covering advanced generics, language features, performance, and SwiftPM basics.
- Added Crust 3 challenges (208–225) covering macro authoring concepts, architecture patterns, testing concepts, diagnostics, and interop topics.
- Added Crust projects (crust1a–crust3c) and wired them into the main flow (passes 7–9).
- Added Crust extra challenges (226–237) for advanced practice.
- Added optional challenge IDs with `challenge:<id>` progress tokens; extras use explicit ids like `crust-extra-async-sleep`.
- Wired fixture-backed stdin/args/file inputs into challenge validation and solution verification for determinism.
- Stage review selection is now deterministic by default (adaptive selection is opt-in).
- Adaptive gating defaulted off; added `--adaptive-on` flag to enable it.
- Updated README and FTS spec to reflect deterministic Phase 1 behavior and fixture usage.
- Ran `scripts/check.sh`; build and tests passed.

## Notes
- Core 2 project `core2a` requires tuple usage; tuples are now taught in Core 2.
- Test runs may require elevated permissions for SwiftPM cache access in sandboxed environments.

## Road Ahead
- Crust: add Crust challenge + project layer, then extras; run sequencing, quality, and overall assessments.
- FTS: apply standards across content/engine and audit for robustness.
- Extras: consider a full curriculum lesson database for deeper, self-contained learning.
